# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py
# RUN: llc -mtriple=mos -run-pass=prologepilog -verify-machineinstrs -o - %s | FileCheck %s
---
name: addrlostk
stack:
  - { id: 0, size: 256 }
  - { id: 1, size: 2 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: addrlostk
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, dead $v = ADCImm $a, 1, $c
    ; CHECK: $rc2 = COPY killed $a
    $rc2, $c, dead $v = AddrLostk %stack.1, 1
...
---
name: addrlostk_0
stack:
  - { id: 0, size: 256 }
  - { id: 1, size: 2 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: addrlostk_0
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $c = LDCImm 0
    ; CHECK: $rc2 = COPY $rc0
    $rc2, $c, dead $v = AddrLostk %stack.1, 0
...
---
name: addrhistk
stack:
  - { id: 0, size: 256 }
  - { id: 1, size: 2 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: addrhistk
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, dead $c, dead $v = ADCImm $a, 1, $c
    ; CHECK: $rc3 = COPY killed $a
    $c = LDCImm 0
    $rc3, dead $c, dead $v = AddrHistk %stack.0, 255, $c
...
---
name: addrhistk_0
stack:
  - { id: 0, size: 256 }
  - { id: 1, size: 2 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: addrhistk_0
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $c = LDCImm 0
    ; CHECK: $rc3 = COPY $rc1
    $c = LDCImm 0
    $rc3, dead $c, dead $v = AddrHistk %stack.1, 0, $c
...
---
name: incsp
stack:
  - { id: 0, size: 1234 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: incsp
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 46, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 251, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 210, $c
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 4, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: RTS
    RTS
...
---
name: incsp_hi_only
stack:
  - { id: 0, size: 512 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: incsp_hi_only
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 2, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: RTS
    RTS
...
---
name: ld_byte
stack:
  - { id: 0, size: 1 }
  - { id: 1, size: 2 }
body:             |
  bb.0.entry:
    ; CHECK-LABEL: name: ld_byte
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 253, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 255, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $y = LDImm 1
    ; CHECK: $a = LDYIndir $rs0, killed $y :: (load 1 from %stack.1 + 1)
    $a, early-clobber $rs1 = LDStk %stack.1, 1 :: (load 1 from %stack.1 + 1)
...
---
name: ld_byte_high
stack:
  - { id: 0, size: 256 }
  - { id: 1, size: 2 }
body:             |
  bb.0.entry:
    ; CHECK-LABEL: name: ld_byte_high
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $c = LDCImm 0
    ; CHECK: $rc2 = COPY $rc0
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 1, $c
    ; CHECK: $rc3 = COPY killed $a
    ; CHECK: $y = LDImm 0
    ; CHECK: $a = LDYIndir $rs1, killed $y :: (load 1 from %stack.0 + 254)
    $a, early-clobber $rs1 = LDStk %stack.0, 254 :: (load 1 from %stack.0 + 254)
...
---
name: ld_byte_x
stack:
  - { id: 0, size: 1 }
  - { id: 1, size: 2 }
body:             |
  bb.0.entry:
    ; CHECK-LABEL: name: ld_byte_x
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 253, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 255, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $y = LDImm 1
    ; CHECK: $a = LDYIndir $rs0, killed $y :: (load 1 from %stack.1 + 1)
    ; CHECK: $x = COPY killed $a
    $x, early-clobber $rs1 = LDStk %stack.1, 1 :: (load 1 from %stack.1 + 1)
...
---
name: ld_byte_xlsb
stack:
  - { id: 0, size: 1 }
  - { id: 1, size: 2 }
body:             |
  bb.0.entry:
    ; CHECK-LABEL: name: ld_byte_xlsb
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 253, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 255, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $y = LDImm 1
    ; CHECK: $a = LDYIndir $rs0, killed $y :: (load 1 from %stack.1 + 1)
    ; CHECK: $x = COPY killed $a
    $xlsb, early-clobber $rs1 = LDStk %stack.1, 1 :: (load 1 from %stack.1 + 1)
...
---
name: ld_byte_c
stack:
  - { id: 0, size: 1 }
  - { id: 1, size: 2 }
body:             |
  bb.0.entry:
    ; CHECK-LABEL: name: ld_byte_c
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 253, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 255, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $y = LDImm 1
    ; CHECK: $a = LDYIndir $rs0, killed $y :: (load 1 from %stack.1 + 1)
    ; CHECK: $c = COPY $alsb
    ; CHECK: $xlsb = COPY killed $c
    $c, early-clobber $rs1 = LDStk %stack.1, 1 :: (load 1 from %stack.1 + 1)
    $xlsb = COPY killed $c
...
---
name: ld_ptr
stack:
  - { id: 0, size: 4 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: ld_ptr
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 252, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 255, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $y = LDImm 2
    ; CHECK: $a = LDYIndir $rs0, killed $y :: (load 1 from %stack.0 + 2, align 2)
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: $y = LDImm 3
    ; CHECK: $a = LDYIndir $rs0, killed $y :: (load 1 from %stack.0 + 3, basealign 2)
    ; CHECK: $rc1 = COPY killed $a
    $rs0, early-clobber $rs1 = LDStk %stack.0, 2 :: (load 2 from %stack.0 + 2)

...
---
name: st_byte
stack:
  - { id: 0, size: 1 }
  - { id: 1, size: 2 }
body:             |
  bb.0.entry:
    ; CHECK-LABEL: name: st_byte
    ; CHECK: $c = LDCImm 0
    ; CHECK: PH $a
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 253, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 255, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: KILL killed $p
    ; CHECK: $y = LDImm 1
    ; CHECK: STYIndir $a, $rs0, killed $y :: (store 1 into %stack.1 + 1)
    early-clobber $rs1 = STStk $a, %stack.1, 1 :: (store 1 into %stack.1 + 1)
...
---
name: st_byte_c
stack:
  - { id: 0, size: 1 }
  - { id: 1, size: 2 }
body:             |
  bb.0.entry:
    ; CHECK-LABEL: name: st_byte_c
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 253, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 255, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $c = COPY $xlsb
    ; CHECK: $alsb = COPY $c
    ; CHECK: $y = LDImm 1
    ; CHECK: STYIndir killed $a, $rs0, killed $y :: (store 1 into %stack.1 + 1)
    $c = COPY $xlsb
    early-clobber $rs1 = STStk killed $c, %stack.1, 1 :: (store 1 into %stack.1 + 1)
...
---
name: st_byte_high
stack:
  - { id: 0, size: 256 }
  - { id: 1, size: 2 }
body:             |
  bb.0.entry:
    ; CHECK-LABEL: name: st_byte_high
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $c = LDCImm 0
    ; CHECK: $rc2 = COPY $rc0
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 1, $c
    ; CHECK: $rc3 = COPY killed $a
    ; CHECK: $a = COPY $x
    ; CHECK: $y = LDImm 0
    ; CHECK: STYIndir killed $a, $rs1, killed $y :: (store 1 into %stack.0 + 254)
    early-clobber $rs1 = STStk $x, %stack.0, 254 :: (store 1 into %stack.0 + 254)
...
---
name: st_ptr
stack:
  - { id: 0, size: 4 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: st_ptr
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 252, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 255, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $rs0 = KILL $rs0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $y = LDImm 2
    ; CHECK: STYIndir killed $a, $rs0, killed $y :: (store 1 into %stack.0 + 2, align 2)
    ; CHECK: $a = COPY $rc1
    ; CHECK: $y = LDImm 3
    ; CHECK: STYIndir killed $a, $rs0, killed $y :: (store 1 into %stack.0 + 3, basealign 2)
    early-clobber $rs1 = STStk $rs0, %stack.0, 2 :: (store 2 into %stack.0 + 2)

...
---
name: variable_sized
stack:
  - { id: 0, type: variable-sized }
  - { id: 1, size: 1 }
  - { id: 2, size: 2 }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: variable_sized
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 253, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 255, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $a = frame-setup COPY $rc30
    ; CHECK: frame-setup PH killed $a
    ; CHECK: $a = frame-setup COPY $rc31
    ; CHECK: frame-setup PH killed $a
    ; CHECK: $rs15 = COPY $rs0
    ; CHECK: $y = LDImm 1
    ; CHECK: $a = LDYIndir $rs15, killed $y :: (load 1 from %stack.2 + 1)
    ; CHECK: $rs0 = COPY $rs15
    ; CHECK: $a = frame-destroy PL
    ; CHECK: $rc31 = frame-destroy COPY killed $a
    ; CHECK: $a = frame-destroy PL
    ; CHECK: $rc30 = frame-destroy COPY killed $a
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 3, $c
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 0, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: RTS implicit $rc30, implicit $rc31
    $a, early-clobber $rs1 = LDStk %stack.2, 1 :: (load 1 from %stack.2 + 1)
    RTS
...
---
name: save_restore_csr
stack:
  - { id: 0, type: variable-sized }
body: |
  bb.0.entry:
    ; CHECK-LABEL: name: save_restore_csr
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 254, $c
    ; CHECK: PH killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 255, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: $a = PL
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: KILL killed $p
    ; CHECK: $a = frame-setup COPY $rc30
    ; CHECK: frame-setup PH killed $a
    ; CHECK: $a = frame-setup COPY $rc31
    ; CHECK: frame-setup PH killed $a
    ; CHECK: $a = frame-setup COPY $rc32
    ; CHECK: frame-setup PH killed $a
    ; CHECK: $a = frame-setup COPY $rc33
    ; CHECK: frame-setup PH killed $a
    ; CHECK: $rs15 = COPY $rs0
    ; CHECK: $a = COPY $rc34
    ; CHECK: $y = LDImm 1
    ; CHECK: STYIndir killed $a, $rs15, killed $y :: (store 1 into %stack.1)
    ; CHECK: $a = COPY $rc35
    ; CHECK: $y = LDImm 0
    ; CHECK: STYIndir killed $a, $rs15, killed $y :: (store 1 into %stack.2)
    ; CHECK: $rs15 = IMPLICIT_DEF
    ; CHECK: $rs16 = IMPLICIT_DEF
    ; CHECK: $rs17 = IMPLICIT_DEF
    ; CHECK: $y = LDImm 0
    ; CHECK: $a = LDYIndir $rs15, killed $y :: (load 1 from %stack.2)
    ; CHECK: $rc35 = COPY killed $a
    ; CHECK: $y = LDImm 1
    ; CHECK: $a = LDYIndir $rs15, killed $y :: (load 1 from %stack.1)
    ; CHECK: $rc34 = COPY killed $a
    ; CHECK: $rs0 = COPY $rs15
    ; CHECK: $a = frame-destroy PL
    ; CHECK: $rc33 = frame-destroy COPY killed $a
    ; CHECK: $a = frame-destroy PL
    ; CHECK: $rc32 = frame-destroy COPY killed $a
    ; CHECK: $a = frame-destroy PL
    ; CHECK: $rc31 = frame-destroy COPY killed $a
    ; CHECK: $a = frame-destroy PL
    ; CHECK: $rc30 = frame-destroy COPY killed $a
    ; CHECK: $c = LDCImm 0
    ; CHECK: $a = COPY $rc0
    ; CHECK: $a, $c, $v = ADCImm $a, 2, $c
    ; CHECK: $rc0 = COPY killed $a
    ; CHECK: $a = COPY $rc1
    ; CHECK: $a, $c, $v = ADCImm $a, 0, $c
    ; CHECK: $rc1 = COPY killed $a
    ; CHECK: RTS implicit $rc30, implicit $rc31, implicit $rc32, implicit $rc33, implicit $rc34, implicit $rc35
    $rs15 = IMPLICIT_DEF
    $rs16 = IMPLICIT_DEF
    $rs17 = IMPLICIT_DEF
    RTS
...
